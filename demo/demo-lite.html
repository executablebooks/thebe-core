<!DOCTYPE html>
<html>
  <head>
    <title><%= htmlWebpackPlugin.options.title %></title>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { fonts: ["TeX"] }
      });
    </script>
    <script
      type="text/javascript"
      async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML"
    ></script>
    <script
      type="text/javascript"
      async
      src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"
    />
    <link rel="stylesheet" href="https://unpkg.com/@curvenote/article/dist/curvenote.css" />
    <script src="https://unpkg.com/@curvenote/article"></script>
    <style>
      body {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Demo: thebe-core</h1>
    <p>
      This is a demonstration of <em>thebe-core</em> starting up and connecting to a jupyterlite
      server
    </p>
    <p />
    <pre>
%matplotlib inline
import numpy as np
import matplotlib.pyplot as plt
import scipy.stats as stats
</pre
    >
    <pre>
mu = 5
sigma = 5</pre
    >
    <pre>
plt.ion()
fig, ax = plt.subplots()
x = np.arange(-10,10,0.1)
y = stats.norm.pdf(x, mu, sigma)
ax.plot(x,y);
plt.grid(True)</pre
    >
    <button id="run-all" disabled>run all</button>
    <button id="run-last" disabled>run last</button>
    <button id="restart" disabled>restart</button>
    <div data-output="true"></div>
    <script>
      const options = {
        useBinder: false,
        useJupyterLite: true,
        requestSession: true,
      };

      function randomId() {
        const uint32 = window.crypto.getRandomValues(new Uint32Array(1))[0];
        return 'id-' + uint32.toString(16);
      }

      const code = [
        `
      %matplotlib inline
      import numpy as np
      import matplotlib.pyplot as plt
      import scipy.stats as stats
      `,
        `
      # oxa:mu
      mu = 5
      # oxa:sigma
      sigma = 5
        `,
        `
      plt.ion()
      fig, ax = plt.subplots()
      x = np.arange(-10,10,0.1)
      y = stats.norm.pdf(x, mu, sigma)
      ax.plot(x,y);
      plt.grid(True)
        `,
      ].map((c) => ({
        id: randomId(),
        source: c,
      }));

      document.addEventListener('DOMContentLoaded', async function () {
        const notebook = thebeCore.api.setupNotebook(code, options);
        const last = notebook.lastCell();
        last.attachToDOM(document.querySelector('[data-output]'));
        const { server, session } = await thebeCore.api.connect(options);

        await server.ready;
        await session.ready;
        console.log('Session ready');
        notebook.attachSession(session);

        const runAllButton = document.getElementById('run-all');
        runAllButton.onclick = (ev) => {
          notebook.executeAll();
        };
        runAllButton.disabled = false;

        const runLastButton = document.getElementById('run-last');
        runLastButton.onclick = (ev) => {
          notebook.executeOnly(notebook.lastCell().id);
        };
        runLastButton.disabled = false;

        const restartButton = document.getElementById('restart');
        restartButton.onclick = (ev) => {
          session.restart();
        };
        restartButton.disabled = false;

        const future = session.kernel.requestExecute({ code: 'print("Hello World!")' });

        await future.done;
      });
    </script>
  </body>
</html>
